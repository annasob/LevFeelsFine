<script src="http://code.jquery.com/jquery.js"></script>
<script>
  var DURATION = 2; // in seconds
  var twitterData = "";
  var locationData = "";
  
  var loadPage1 = function() {
    document.getElementById("page2").style.display = "none";
    document.getElementById("page1").style.display = "inline";
  };
    
  var loadPage2 = function() {
    document.getElementById("page1").style.display = "none";
    document.getElementById("page2").style.display = "inline";
  };
  
  var run = function() {
    twitterData = document.getElementById("twitter").value;
    locationData = document.getElementById("location").value;
    
    loadPage2();
    playVideo();
  };

  
  var playVideo = function() {
    var interval = 0;
    var images = [];
    var done = false;
    var i = 0;
    var image = document.getElementById("image");
    image.style.display = "none";
    $.getJSON("http://api.flickr.com/services/feeds/photos_public.gne?tags=" + "sad" + "&lang=en-us&format=json&jsoncallback=?", function(data){
      images = data.items;    
      var video = document.getElementById("video");
      var canvasCtx = document.getElementById("canvas").getContext("2d");
        
      var getIndex = function() {
        if (i < images.length) {
          return i++;
        } else {
          i = 1;
          return 0;
        }
      };
      
      window.setInterval((function() {
        if (interval < DURATION*1000) {
          video.play();
          canvasCtx.drawImage(video, 0, 0, video.width, video.height);
          if (!done) {
            image.src = images[getIndex()].media.m.replace("_m.jpg", ".jpg");
            done = true;
          }
        } else if (interval >= DURATION*1000 && interval < (DURATION*1000)*2) {
          video.pause();
          video.currentTime = 0;
          canvasCtx.drawImage(image, 0, 0, video.width, video.height);
        } else {
          interval = 0;
          done = false;
        }
        interval+=10;
      }), 10);
    });

  };
</script>
<div id="page1">
  Location: <input id="location" type="text" value="ignore me - just click" name="location" /><br />
  Twitter:  <input id="twitter" type="text" value="ignore me - just click" name="twitter" /><br />
  <button type="button" onClick="run();">Click Me!</button><br />
</div>
<div id="page2">
  <video src="video.ogv" style="display:none;" width="270" height="270" id="video"></video>
  <img style="display:none;" width="270" height="270" id="image" />
  <canvas id="canvas" width="270" height="270"></canvas>
  <p id="write"></p>
</div>
